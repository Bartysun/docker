 ## Part 1. Готовый докер

- Возьмем официальный докер-образ с nginx и выкачаем его при помощи `docker pull`
![1](<images/Снимок экрана_2024-11-27_20-40-30.jpg>)  *скачивание образа nginx*

- Удостоверимся, что докер-образ с nginx существует на нашем пк с помощью команды `docker images`
![2](<images/Снимок экрана_2024-11-27_20-45-51.jpg>) *проверка существования образа nginx*

- Запускаем докер-образ через `docker run -d [image_id|repository]`
![alt text](<images/Снимок экрана_2024-11-27_20-47-41.jpg>) *запуск образа nginx*

- Проверяем, запустился ли образ через `docker ps`
![alt text](<images/Снимок экрана_2024-11-27_20-49-18.jpg>)  *проверка запуска образа nginx*

- Посмотрим информацию о контейнере с помощью `docker inspect [container_id|container_name]`, узнаем размер контейнера, список замапленных портов и ip:
![alt text](<images/Снимок экрана_2024-11-27_21-17-42.jpg>) *получение информации об образе nginx*
![alt text](<images/Снимок экрана_2024-11-27_21-23-19.jpg>) *замапленный порт*
![alt text](<images/Снимок экрана_2024-11-27_21-26-53.jpg>) *размер и IP контейнера*

- Остановим докер-образ с помощью `docker stop [container_id|container_name]` и проверим, получилось ли с помощью `docker ps`:
![alt text](<images/Снимок экрана_2024-11-27_21-31-58.jpg>)  *остановка образа nginx и проверка остановки*

- Запустим докер с портами 80 и 443 в контейнере, замапленными на такие же порты на локальной машине, через команду run.
![alt text](<images/Снимок экрана_2024-11-27_21-38-21.jpg>) *запуск образа nginx с портами 80 и 443*

- Проверим, что в браузере по адресу localhost:80 доступна стартовая страница nginx.
![](<images/Снимок экрана_2024-11-27_21-39-40.jpg>)
- Перезапустим докер контейнер через `docker restart [container_id|container_name]` и проверим успешно ли выполнилась команда:
![alt text](<images/Снимок экрана_2024-11-27_21-47-31.jpg>)
*перезапуск образа nginx*
![alt text](<images/Снимок экрана_2024-11-27_21-58-17.jpg>)

## Part 2. Операции с контейнером

- Прочитаем конфигурационный файл *nginx.conf* внутри докер контейнера через команду *exec*:
![alt text](<images/Снимок экрана_2024-11-27_22-09-06.jpg>) *получение конфигурационного файла*

- Создадим в локальном репозитории файл *nginx.conf* и настроим в нем по пути */status* отдачу страницы статуса сервера **nginx**.
![alt text](<images/Снимок экрана_2024-11-27_23-00-52.jpg>) *создание конфигурационного файла*

- Скопируем созданный файл *nginx.conf* внутрь докер-образа через команду `docker cp`.
![alt text](<images/Снимок экрана_2024-11-27_22-59-55.jpg>)

- Перезапустим **nginx** внутри докер-образа через команду *exec*:
![alt text](<images/Снимок экрана_2024-11-27_23-04-42.jpg>)

- Проверим, что по адресу *localhost:80/status* отдается страничка со статусом сервера **nginx**.
![alt text](<images/Снимок экрана_2024-11-27_23-25-06.jpg>)
 
- Экспортируем контейнер в файл *container.tar* через команду *export*, затем остановим контейнер:
![alt text](<images/Снимок экрана_2024-11-28_00-13-37.jpg>)

- Удалим образ через `docker rmi [image_id|repository]`, не удаляя перед этим контейнеры:
![alt text](<images/Снимок экрана_2024-11-28_00-23-53.jpg>)

- Далее удалим остановленный контейнер командой `docker rm [container_id|container_name]`:
![alt text](<images/Снимок экрана_2024-11-28_00-29-25.jpg>)

- Импортируем контейнер обратно через команду *import*:
![alt text](<images/Снимок экрана_2024-11-28_01-59-58.jpg>)
*опция -c, позволяет указать команду, которая будет выполняться при запуске контейнера.
"-g" в данной команде позволяет указать глобальные директивы в конфигурационном файле nginx при запуске контейнера, и "daemon off;" используется для того, чтобы nginx работал внутри контейнера и продолжал обрабатывать запросы.*

- Запустим импортированный контейнер:
![alt text](<images/Снимок экрана_2024-11-28_02-02-09.jpg>)

- Проверим, что по адресу *localhost:80/status* отдается страничка со статусом сервера **nginx**.
![alt text](<images/Снимок экрана_2024-11-28_02-15-18.jpg>)
Затем проверим работу страницы в браузере
![alt text](<images/Снимок экрана_2024-11-28_02-20-04.jpg>)

## Part 3. Мини веб-сервер

- Пишем мини сервер на C и FastCgi, который будет возвращать простейшую страничку с надписью 'Hello World!'
![alt text](<images/Снимок экрана_2024-11-28_11-41-41.jpg>)

- Запускаем написанный мини-сервер через spawn-fcgi на порту 8080. С предварительной установкой самой библиотекой FastCgi `sudo apt install libfcgi-dev spawn-fgci`
![alt text](<images/Снимок экрана_2024-11-28_11-57-00.jpg>)

- Пишем свой nginx.conf, который будет проксировать все запросы с 81 порта на 127.0.0.1:8080,  c помощью команды 
![alt text](<images/Снимок экрана_2024-11-28_12-31-54.jpg>)

- Копируем все в контейнер и заходим в него
![alt text](<images/Снимок экрана_2024-11-28_12-53-59.jpg>)
![alt text](<images/Снимок экрана_2024-11-28_13-04-57.jpg>)
![alt text](<images/Снимок экрана_2024-11-28_13-15-49.jpg>)

- Устанавливаем необходимые библиотеки
![alt text](<images/Снимок экрана_2024-11-28_13-20-57.jpg>)

- Компилируем и запускаем сервер
![alt text](<images/Снимок экрана_2024-11-28_13-26-46.jpg>)

- Проверяем работу сервера
![alt text](<images/Снимок экрана_2024-11-28_13-28-28.jpg>)
![alt text](<images/Снимок экрана_2024-11-28_13-31-00.jpg>)

- Положим файл nginx.conf по пути ./nginx/nginx.conf (это понадобится позже).
![alt text](<images/Снимок экрана_2024-11-28_12-43-40.jpg>)

## Part 4. Свой докер

- Собираем исходники мини сервера на FastCgi из Части 3:
- Создаём докерфайл
![alt text](<images/Снимок экрана_2024-11-28_13-58-52.jpg>)

- Создаём скрипт, выполняющий роль entrypoint
![alt text](<images/Снимок экрана_2024-11-28_14-24-05.jpg>)

- Запуск на 8080 порту;
![alt text](<images/Снимок экрана_2024-11-28_14-49-30.jpg>)

- Копирование внутрь образа написанного ./nginx/nginx.conf
![alt text](<images/Снимок экрана_2024-11-28_14-48-25.jpg>)

- Запусает nginx в фоновом режиме
![alt text](<images/Снимок экрана_2024-11-28_14-49-07.jpg>)

- Собираем docker-image, указывая имя и тэг
![alt text](<images/Снимок экрана_2024-11-28_14-39-26.jpg>)

- Проверяем наличие docker-image
![alt text](<images/Снимок экрана_2024-11-28_14-41-11.jpg>)

- Запускаем собранный докер образ с маппингом 81 порта на 80 на локальной машине и маппингом папки ./nginx внутрь контейнера по адресу, где лежат конфигурационные файлы nginx'а и проверяем что по localhost:80 доступна страничка написанного мини сервера.
![alt text](<images/Снимок экрана_2024-11-28_18-50-13.jpg>)

- Допиши в ./nginx/nginx.conf проксирование странички /status, по которой надо отдавать статус сервера nginx.
Перезапусти докер-образ.
Если всё сделано верно, то, после сохранения файла и перезапуска контейнера, конфигурационный файл внутри докер-образа должен обновиться самостоятельно без лишних действий.
Проверь, что теперь по localhost:80/status отдается страничка со статусом nginx
![alt text](<images/Снимок экрана_2024-11-28_18-59-13.jpg>)
![alt text](<images/Снимок экрана_2024-11-28_21-37-06.jpg>)

## Part 5. **Dockle**

-После написания образа никогда не будет лишним проверить его на безопасность.
- Устанавливаем Dockle
![alt text](<images/Снимок экрана_2024-11-28_21-44-37.jpg>)

- Проверяем наш докер-образ с помощью dockle
![alt text](<images/Снимок экрана_2024-11-28_21-46-48.jpg>)

- Исправляем dockerfile, чтобы убрать все имеющиеся ошибки и предупреждения
![alt text](<images/Снимок экрана_2024-11-28_23-36-43.jpg>)
*исправлены ошибки DKL-DI-0007, DKL-DI-0005, DKL-DI-0001, DKL-DI-0005, CIS-DI-0006*

- "CIS-DI-0005: Enable Content trust for Docker" перед тем как собрать докер, использую эту команду "export DOCKER_CONTENT_TRUST=1"
- Сборка докер-образа и проверка его работоспособности с помощью dockle:
![alt text](<images/Снимок экрана_2024-11-28_23-35-57.jpg>)

## Part 6. Базовый **Docker Compose**
- Вот ты и закончил свою разминку. А хотя погоди...
Почему бы не поэкспериментировать с развёртыванием проекта, состоящего сразу из нескольких докер-образов?

- Для того, чтобы собрать докер-контейнер на nginx, портирующий запромы с 8080 порта на 81 порт ранее запущенного контейнера необходимо изменить содержания конфигурационных файлов:
-  изменения в файле nginx.conf
![alt text](<images/Снимок экрана_2024-11-29_00-45-26.jpg>) 

- изменения в файле dockerfile
![alt text](<images/Снимок экрана_2024-11-29_00-46-16.jpg>) 

- изменения в файле run.sh
![alt text](<images/Снимок экрана_2024-11-29_00-47-16.jpg>)  

- создаем файл docker-compose.yml
![alt text](<images/Снимок экрана_2024-11-29_00-43-16.jpg>)

- Остановим все запущенные контейнеры
![alt text](<images/Снимок экрана_2024-11-29_00-11-09.jpg>)

- Соберем проект командой `docker-compose build`
![alt text](<images/Снимок экрана_2024-11-29_00-03-44.jpg>)

- Запустим проект командой `docker-compose up`
![alt text](<images/Снимок экрана_2024-11-29_00-50-12.jpg>)

- Проверим отдачу страницы в браузере по адресу `localhost:80`
![alt text](<images/Снимок экрана_2024-11-29_00-42-10.jpg>)